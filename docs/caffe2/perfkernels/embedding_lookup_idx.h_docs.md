# Documentation: `caffe2/perfkernels/embedding_lookup_idx.h`

## File Metadata

- **Path**: `caffe2/perfkernels/embedding_lookup_idx.h`
- **Size**: 1,674 bytes (1.63 KB)
- **Type**: C/C++ Header File
- **Extension**: `.h`

## File Purpose

This is a c/c++ header file that is part of the PyTorch project.

## Original Source

```c
#pragma once

#include <cstdint>

namespace caffe2 {

// clang-format off
/**
 * Embedding lookup with reduction.
 *
 * `input` of size data_size * block_size
 * `indices` of size index_size
 * `offsets` of size output_size
 * `weights` nullptr or array of size index_size
 * `out` of size output_size * block_size
 *
 * Behavior is roughly equivalent to pseudocode:
 *
 * pos = 0
 * for (i = 0..output_size-1)
 *   for (k = 0..block_size-1)
 *     out[i*block_size + k] = 0
 *   start_offset = offsets[i]
 *   end_offset = offsets[i+1]
 *   length = end_offset - start_offset
 *   for (j = start_offset..end_offset-1)
 *     for (k = 0..block_size-1)
 *       out[i*block_size + k] += input[indices[pos]*block_size + k] *
 *           (weights ? weights[IS_WEIGHT_POSITIONAL ? j - start_offset : pos] : 1.0)
 *     pos += 1
 *   if (normalize_weights && length > 0)
 *     for (k = 0..block_size-1)
 *       out[i*block_size + k] /= length
 *
 * TODO: make this API also take "offsets" rather than "lengths" to match the
 *       API for PyTorch's EmbeddingBag
 */
// clang-format on
template <
    typename IndexType,
    typename InType,
    typename OutType,
    bool IS_WEIGHT_POSITIONAL = false>
void EmbeddingLookupIdx(
    const std::int64_t block_size,
    const std::int64_t output_size,
    const std::int64_t index_size,
    const std::int64_t data_size,
    const InType* input,
    const IndexType* indices,
    const IndexType* offsets,
    const float* weights, // optional, can be null for non-weighted sum
    const float* scale_bias, // optional scale & bias params for uint8 input
    bool normalize_by_lengths,
    OutType* out);

} // namespace caffe2

```



## High-Level Overview


This C++ file contains approximately 0 class(es)/struct(s) and 1 function(s).

## Detailed Analysis

### Code Structure

**Namespaces**: `caffe2`


*For complete code details, see the Original Source section above.*


## Architecture & Design

### Role in PyTorch Architecture

This file is located in `caffe2/perfkernels`, which is part of the **Caffe2** deep learning framework.



## Dependencies

### Import Dependencies

This file includes:

- `cstdint`


## Code Patterns & Idioms

### Common Patterns

*No specific patterns automatically detected.*


## Performance Considerations

### Performance Notes


*Detailed performance analysis requires profiling and benchmarking.*


## Security & Safety

### Security Considerations

- No obvious security concerns detected in automated analysis.

*Manual security review is recommended for production code.*


## Testing & Usage

### Testing

Test files for this module may be located in the `test/` directory.

### Usage Examples

*See the source code and related test files for usage examples.*


## Related Files

### Related Files

Files in the same folder (`caffe2/perfkernels`):

- [`embedding_lookup_idx_avx2.cc_docs.md`](./embedding_lookup_idx_avx2.cc_docs.md)
- [`common.h_docs.md`](./common.h_docs.md)
- [`hp_emblookup_codegen.py_docs.md`](./hp_emblookup_codegen.py_docs.md)
- [`common_avx2.cc_docs.md`](./common_avx2.cc_docs.md)
- [`embedding_lookup_idx.cc_docs.md`](./embedding_lookup_idx.cc_docs.md)
- [`batch_box_cox_vec.h_docs.md`](./batch_box_cox_vec.h_docs.md)
- [`CMakeLists.txt_docs.md`](./CMakeLists.txt_docs.md)
- [`sve_emblookup_codegen.py_docs.md`](./sve_emblookup_codegen.py_docs.md)
- [`batch_box_cox_avx512.cc_docs.md`](./batch_box_cox_avx512.cc_docs.md)
- [`embedding_lookup_idx_sve.cc_docs.md`](./embedding_lookup_idx_sve.cc_docs.md)


## Cross-References

- **File Documentation**: `embedding_lookup_idx.h_docs.md`
- **Keyword Index**: `embedding_lookup_idx.h_kw.md`
- **Folder Index**: `index.md`
- **Folder Documentation**: `doc.md`

---

*Generated by PyTorch Repository Documentation System*
