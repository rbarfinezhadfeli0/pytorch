# Documentation: test_custom_backend.py

## File Metadata
- **Path**: `test/custom_backend/test_custom_backend.py`
- **Size**: 1655 bytes
- **Lines**: 54
- **Extension**: .py
- **Type**: Regular file

## Original Source

```py
# Owner(s): ["module: unknown"]

import tempfile

from backend import get_custom_backend_library_path, Model, to_custom_backend

import torch
from torch.testing._internal.common_utils import run_tests, TestCase


class TestCustomBackend(TestCase):
    def setUp(self):
        super().setUp()
        # Load the library containing the custom backend.
        self.library_path = get_custom_backend_library_path()
        torch.ops.load_library(self.library_path)
        # Create an instance of the test Module and lower it for
        # the custom backend.
        self.model = to_custom_backend(torch.jit.script(Model()))

    def test_execute(self):
        """
        Test execution using the custom backend.
        """
        a = torch.randn(4)
        b = torch.randn(4)
        # The custom backend is hardcoded to compute f(a, b) = (a + b, a - b).
        expected = (a + b, a - b)
        out = self.model(a, b)
        self.assertTrue(expected[0].allclose(out[0]))
        self.assertTrue(expected[1].allclose(out[1]))

    def test_save_load(self):
        """
        Test that a lowered module can be executed correctly
        after saving and loading.
        """
        # Test execution before saving and loading to make sure
        # the lowered module works in the first place.
        self.test_execute()

        # Save and load.
        with tempfile.NamedTemporaryFile() as f:
            f.close()
            torch.jit.save(self.model, f.name)
            loaded = torch.jit.load(f.name)
            self.model = loaded

        # Test execution again.
        self.test_execute()


if __name__ == "__main__":
    run_tests()

```

## High-Level Overview

This file is part of the PyTorch repository. It is a Python source file that may contain classes, functions, and module-level code.

## Detailed Walkthrough

### Classes
This file defines 1 class(es): TestCustomBackend

### Functions
This file defines 3 function(s): setUp, test_execute, test_save_load


## Key Components

The file contains 166 words across 54 lines of code/text.

## Usage & Examples

This file is part of the larger PyTorch codebase. For usage examples, refer to related test files and documentation.

## Performance & Security Notes

- File size: 1655 bytes
- Complexity: Standard

## Related Files

See the folder index for related files in the same directory.

## Testing

Refer to the PyTorch test suite for test coverage of this file.

---
*Generated by Repo Book Generator v1.0*
