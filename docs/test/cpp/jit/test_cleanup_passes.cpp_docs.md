# Documentation: test_cleanup_passes.cpp

## File Metadata
- **Path**: `test/cpp/jit/test_cleanup_passes.cpp`
- **Size**: 1455 bytes
- **Lines**: 49
- **Extension**: .cpp
- **Type**: Regular file

## Original Source

```cpp
#include <gtest/gtest.h>

#include <torch/csrc/jit/frontend/ir_emitter.h>
#include <torch/csrc/jit/ir/ir.h>
#include <torch/csrc/jit/ir/irparser.h>
#include <torch/csrc/jit/testing/file_check.h>

namespace torch {
namespace jit {

TEST(CleanupPassTest, Basic) {
  // Tests stability of clean up passes when dealing with constant pooling
  // and constant propagation.
  auto graph = std::make_shared<Graph>();
  parseIR(
      R"IR(
graph(%cond.1 : Tensor,
      %suffix.1 : str):
  %3 : bool = aten::Bool(%cond.1) # o.py:6:7
  %25 : str = prim::If(%3) # o.py:6:4
    block0():
      %a.1 : str = prim::Constant[value="same string"]()
      %b.1 : str = prim::Constant[value=" with a twist"]()
      %7 : str = aten::add(%a.1, %b.1)
      %11 : str = aten::add(%7, %suffix.1) # o.py:10:15
      -> (%11)
    block1():
      %c.1 : str = prim::Constant[value="same string"]()
      %d.1 : str = prim::Constant[value=" with a twist"]()
      %12 : str = aten::add(%c.1, %d.1)
      -> (%12)
  return (%25)
  )IR",
      &*graph);
  runCleanupPasses(graph);
  testing::FileCheck()
      .check_count(
          "prim::Constant[value=\"same string with a twist\"]",
          1,
          /*exactly=*/true)
      ->run(*graph);

  auto graph_after_pass_once = graph->toString();
  runCleanupPasses(graph);
  auto graph_after_pass_twice = graph->toString();
  ASSERT_EQ(graph_after_pass_once, graph_after_pass_twice);
}
} // namespace jit
} // namespace torch

```

## High-Level Overview

This file is part of the PyTorch repository. It is a C++/CUDA source/header file that may contain implementations, declarations, or kernel code.

## Detailed Walkthrough


## Key Components

The file contains 150 words across 49 lines of code/text.

## Usage & Examples

This file is part of the larger PyTorch codebase. For usage examples, refer to related test files and documentation.

## Performance & Security Notes

- File size: 1455 bytes
- Complexity: Standard

## Related Files

See the folder index for related files in the same directory.

## Testing

Refer to the PyTorch test suite for test coverage of this file.

---
*Generated by Repo Book Generator v1.0*
