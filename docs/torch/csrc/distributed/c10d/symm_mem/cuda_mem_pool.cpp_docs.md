# Documentation: cuda_mem_pool.cpp

## File Metadata
- **Path**: `torch/csrc/distributed/c10d/symm_mem/cuda_mem_pool.cpp`
- **Size**: 1504 bytes
- **Lines**: 39
- **Extension**: .cpp
- **Type**: Regular file

## Original Source

```cpp
#include <torch/csrc/cuda/CUDAPluggableAllocator.h>
#include <torch/csrc/distributed/c10d/symm_mem/SymmetricMemory.hpp>

namespace {
using namespace c10d::symmetric_memory;

// Alloc functor for MemPool
void* cuda_symm_alloc(size_t size, int device, void* stream) {
  static auto allocator = get_allocator(c10::DeviceType::CUDA);
  TORCH_CHECK(
      allocator->name() == "NVSHMEM", "Only NVSHMEM backend is supported");
  // Note: this alloc functor works for the NVSHMEM and NCCL backends only,
  // because only these backends takes `nullopt` for the `group` argument which
  // is not given by MemPool's invocation (actually these two backends requires
  // it to be `nullopt`).
  return allocator->alloc(size, device, /*group_name=*/std::nullopt);
}

// Free functor for MemPool
void cuda_symm_free(void* ptr, size_t size, int device, void* stream) {
  static auto allocator = get_allocator(c10::DeviceType::CUDA);
  TORCH_CHECK(
      allocator->name() == "NVSHMEM", "Only NVSHMEM backend is supported");
  allocator->free(ptr);
}

// Register allocator for CUDA MemPool
struct RegisterCUDAMemPoolAllocator {
  RegisterCUDAMemPoolAllocator() {
    std::shared_ptr<c10::cuda::CUDACachingAllocator::CUDAAllocator> allocator =
        torch::cuda::CUDAPluggableAllocator::createCustomAllocator(
            cuda_symm_alloc, cuda_symm_free);
    register_mempool_allocator(c10::DeviceType::CUDA, allocator);
  }
};

static RegisterCUDAMemPoolAllocator register_cuda_mempool_allocator_;

} // namespace

```

## High-Level Overview

This file is part of the PyTorch repository. It is a C++/CUDA source/header file that may contain implementations, declarations, or kernel code.

## Detailed Walkthrough

### Structures
This file defines 1 struct(s): RegisterCUDAMemPoolAllocator


## Key Components

The file contains 141 words across 39 lines of code/text.

## Usage & Examples

This file is part of the larger PyTorch codebase. For usage examples, refer to related test files and documentation.

## Performance & Security Notes

- File size: 1504 bytes
- Complexity: Standard

## Related Files

See the folder index for related files in the same directory.

## Testing

Refer to the PyTorch test suite for test coverage of this file.

---
*Generated by Repo Book Generator v1.0*
