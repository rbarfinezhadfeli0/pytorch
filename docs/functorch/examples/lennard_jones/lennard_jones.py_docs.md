# Documentation: `functorch/examples/lennard_jones/lennard_jones.py`

## File Metadata

- **Path**: `functorch/examples/lennard_jones/lennard_jones.py`
- **Size**: 2,052 bytes (2.00 KB)
- **Type**: Python Source Code
- **Extension**: `.py`

## File Purpose

This file contains **examples or benchmarks**.

## Original Source

```python
# This example was adapted from https://github.com/muhrin/milad
# It is licensed under the GLPv3 license. You can find a copy of it
# here: https://www.gnu.org/licenses/gpl-3.0.en.html .

import torch
from torch import nn
from torch.func import jacrev, vmap
from torch.nn.functional import mse_loss


sigma = 0.5
epsilon = 4.0


def lennard_jones(r):
    return epsilon * ((sigma / r) ** 12 - (sigma / r) ** 6)


def lennard_jones_force(r):
    """Get magnitude of LJ force"""
    return -epsilon * ((-12 * sigma**12 / r**13) + (6 * sigma**6 / r**7))


training_size = 1000
r = torch.linspace(0.5, 2 * sigma, steps=training_size, requires_grad=True)

# Create a bunch of vectors that point along positive-x
drs = torch.outer(r, torch.tensor([1.0, 0, 0]))
norms = torch.norm(drs, dim=1).reshape(-1, 1)
# Create training energies
training_energies = torch.stack(list(map(lennard_jones, norms))).reshape(-1, 1)
# Create forces with random direction vectors
training_forces = torch.stack(
    [force * dr for force, dr in zip(map(lennard_jones_force, norms), drs)]
)

model = nn.Sequential(
    nn.Linear(1, 16),
    nn.Tanh(),
    nn.Linear(16, 16),
    nn.Tanh(),
    nn.Linear(16, 16),
    nn.Tanh(),
    nn.Linear(16, 16),
    nn.Tanh(),
    nn.Linear(16, 1),
)


def make_prediction(model, drs):
    norms = torch.norm(drs, dim=1).reshape(-1, 1)
    energies = model(norms)

    network_derivs = vmap(jacrev(model))(norms).squeeze(-1)
    forces = -network_derivs * drs / norms
    return energies, forces


def loss_fn(energies, forces, predicted_energies, predicted_forces):
    return (
        mse_loss(energies, predicted_energies)
        + 0.01 * mse_loss(forces, predicted_forces) / 3
    )


optimiser = torch.optim.Adam(model.parameters(), lr=1e-3)

for epoch in range(400):
    optimiser.zero_grad()
    energies, forces = make_prediction(model, drs)
    loss = loss_fn(training_energies, training_forces, energies, forces)
    loss.backward(retain_graph=True)
    optimiser.step()

    if epoch % 20 == 0:
        print(loss.cpu().item())

```



## High-Level Overview

"""Get magnitude of LJ force"""    return -epsilon * ((-12 * sigma**12 / r**13) + (6 * sigma**6 / r**7))training_size = 1000r = torch.linspace(0.5, 2 * sigma, steps=training_size, requires_grad=True)# Create a bunch of vectors that point along positive-xdrs = torch.outer(r, torch.tensor([1.0, 0, 0]))norms = torch.norm(drs, dim=1).reshape(-1, 1)# Create training energiestraining_energies = torch.stack(list(map(lennard_jones, norms))).reshape(-1, 1)# Create forces with random direction vectorstraining_forces = torch.stack(    [force * dr for force, dr in zip(map(lennard_jones_force, norms), drs)])model = nn.Sequential(    nn.Linear(1, 16),    nn.Tanh(),    nn.Linear(16, 16),    nn.Tanh(),    nn.Linear(16, 16),    nn.Tanh(),    nn.Linear(16, 16),    nn.Tanh(),    nn.Linear(16, 1),)def make_prediction(model, drs):

This Python file contains 0 class(es) and 4 function(s).

## Detailed Analysis

### Code Structure

**Functions defined**: `lennard_jones`, `lennard_jones_force`, `make_prediction`, `loss_fn`

**Key imports**: torch, nn, jacrev, vmap, mse_loss


*For complete code details, see the Original Source section above.*


## Architecture & Design

### Role in PyTorch Architecture

This file is located in `functorch/examples/lennard_jones`, which is part of the **core PyTorch library**.



## Dependencies

### Import Dependencies

This file imports:

- `torch`
- `torch.func`: jacrev, vmap
- `torch.nn.functional`: mse_loss


## Code Patterns & Idioms

### Common Patterns

- **Neural Network**: Defines or uses PyTorch neural network components


## Performance Considerations

### Performance Notes


*Detailed performance analysis requires profiling and benchmarking.*


## Security & Safety

### Security Considerations

- No obvious security concerns detected in automated analysis.

*Manual security review is recommended for production code.*


## Testing & Usage

### Testing

Test files for this module may be located in the `test/` directory.

### Usage Examples

*See the source code and related test files for usage examples.*


## Related Files

### Related Files

Files in the same folder (`functorch/examples/lennard_jones`):



## Cross-References

- **File Documentation**: `lennard_jones.py_docs.md`
- **Keyword Index**: `lennard_jones.py_kw.md`
- **Folder Index**: `index.md`
- **Folder Documentation**: `doc.md`

---

*Generated by PyTorch Repository Documentation System*
