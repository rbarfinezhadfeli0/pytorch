# Documentation: `docs/functorch/examples/compilation/fuse_module.py_docs.md`

## File Metadata

- **Path**: `docs/functorch/examples/compilation/fuse_module.py_docs.md`
- **Size**: 3,784 bytes (3.70 KB)
- **Type**: Markdown Documentation
- **Extension**: `.md`

## File Purpose

This file is part of the **documentation**. This file contains **examples or benchmarks**.

## Original Source

```markdown
# Documentation: `functorch/examples/compilation/fuse_module.py`

## File Metadata

- **Path**: `functorch/examples/compilation/fuse_module.py`
- **Size**: 1,455 bytes (1.42 KB)
- **Type**: Python Source Code
- **Extension**: `.py`

## File Purpose

This file contains **examples or benchmarks**.

## Original Source

```python
import timeit

import torch
import torch.nn as nn
from functorch.compile import compiled_module, tvm_compile


def nop(f, _):
    return f


fw_compiler = tvm_compile(target="llvm", tuning_logfile="fw_keops")
bw_compiler = tvm_compile(target="llvm", tuning_logfile="bw_keops")
fw_compiler = nop
bw_compiler = nop


def run(mod, input):
    out = mod(input)
    out.sum().backward()
    grads = [p.grad for p in mod.parameters()]
    return (out, *grads)


class Foo(nn.Module):
    def __init__(self) -> None:
        super().__init__()
        self.param = nn.Parameter(torch.randn(1))
        self.register_buffer("buf", torch.randn(1))

    def forward(self, x):
        return (self.param * x + self.buf).sum(dim=0)


input = torch.randn(1)
mod = Foo()
compiled_mod = compiled_module(mod, fw_compiler, bw_compiler)

for a, b in zip(run(mod, input), run(compiled_mod, input)):
    torch.testing.assert_close(a, b)

out = mod(input)
out.sum().backward()
mod.param.data -= mod.param.grad
compiled_mod.orig_module.param.data -= compiled_mod.orig_module.param.grad
compiled_mod.orig_module.param.grad = None

for a, b in zip(run(mod, input), run(compiled_mod, input)):
    torch.testing.assert_close(a, b)

for _ in range(5):
    i = 10000
    t = timeit.Timer("mod(input)", globals=globals()).timeit(10000)
    print(f"eager {t / i * 1e6}")
    t = timeit.Timer("compiled_mod(input)", globals=globals()).timeit(10000)
    print(f"compiled {t / i * 1e6}")

```



## High-Level Overview


This Python file contains 1 class(es) and 4 function(s).

## Detailed Analysis

### Code Structure

**Classes defined**: `Foo`

**Functions defined**: `nop`, `run`, `__init__`, `forward`

**Key imports**: timeit, torch, torch.nn as nn, compiled_module, tvm_compile


*For complete code details, see the Original Source section above.*


## Architecture & Design

### Role in PyTorch Architecture

This file is located in `functorch/examples/compilation`, which is part of the **core PyTorch library**.



## Dependencies

### Import Dependencies

This file imports:

- `timeit`
- `torch`
- `torch.nn as nn`
- `functorch.compile`: compiled_module, tvm_compile


## Code Patterns & Idioms

### Common Patterns

- **Object-Oriented Design**: Uses classes and constructors
- **Neural Network**: Defines or uses PyTorch neural network components


## Performance Considerations

### Performance Notes

- May involve **JIT compilation** or compilation optimizations.

*Detailed performance analysis requires profiling and benchmarking.*


## Security & Safety

### Security Considerations

- No obvious security concerns detected in automated analysis.

*Manual security review is recommended for production code.*


## Testing & Usage

### Testing

Test files for this module may be located in the `test/` directory.

### Usage Examples

*See the source code and related test files for usage examples.*


## Related Files

### Related Files

Files in the same folder (`functorch/examples/compilation`):

- [`eager_fusion.py_docs.md`](./eager_fusion.py_docs.md)
- [`simple_function.py_docs.md`](./simple_function.py_docs.md)
- [`README.md_docs.md`](./README.md_docs.md)
- [`linear_train.py_docs.md`](./linear_train.py_docs.md)


## Cross-References

- **File Documentation**: `fuse_module.py_docs.md`
- **Keyword Index**: `fuse_module.py_kw.md`
- **Folder Index**: `index.md`
- **Folder Documentation**: `doc.md`

---

*Generated by PyTorch Repository Documentation System*

```



## High-Level Overview

This file is part of the PyTorch framework located at `docs/functorch/examples/compilation`.

## Detailed Analysis

### Code Structure


*For complete code details, see the Original Source section above.*


## Architecture & Design

### Role in PyTorch Architecture

This file is located in `docs/functorch/examples/compilation`, which is part of the **core PyTorch library**.



## Dependencies

### Import Dependencies

*Dependency analysis not applicable for this file type.*


## Code Patterns & Idioms

### Common Patterns

- **Object-Oriented Design**: Uses classes and constructors
- **Neural Network**: Defines or uses PyTorch neural network components


## Performance Considerations

### Performance Notes

- May involve **JIT compilation** or compilation optimizations.
- Contains **benchmarking** code or performance tests.

*Detailed performance analysis requires profiling and benchmarking.*


## Security & Safety

### Security Considerations

- No obvious security concerns detected in automated analysis.

*Manual security review is recommended for production code.*


## Testing & Usage

### Testing

Test files for this module may be located in the `test/` directory.

### Usage Examples

*See the source code and related test files for usage examples.*


## Related Files

### Related Files

Files in the same folder (`docs/functorch/examples/compilation`):

- [`linear_train.py_docs.md_docs.md`](./linear_train.py_docs.md_docs.md)
- [`README.md_docs.md_docs.md`](./README.md_docs.md_docs.md)
- [`simple_function.py_kw.md_docs.md`](./simple_function.py_kw.md_docs.md)
- [`eager_fusion.py_kw.md_docs.md`](./eager_fusion.py_kw.md_docs.md)
- [`linear_train.py_kw.md_docs.md`](./linear_train.py_kw.md_docs.md)
- [`eager_fusion.py_docs.md_docs.md`](./eager_fusion.py_docs.md_docs.md)
- [`README.md_kw.md_docs.md`](./README.md_kw.md_docs.md)
- [`fuse_module.py_kw.md_docs.md`](./fuse_module.py_kw.md_docs.md)
- [`simple_function.py_docs.md_docs.md`](./simple_function.py_docs.md_docs.md)


## Cross-References

- **File Documentation**: `fuse_module.py_docs.md_docs.md`
- **Keyword Index**: `fuse_module.py_docs.md_kw.md`
- **Folder Index**: `index.md`
- **Folder Documentation**: `doc.md`

---

*Generated by PyTorch Repository Documentation System*
