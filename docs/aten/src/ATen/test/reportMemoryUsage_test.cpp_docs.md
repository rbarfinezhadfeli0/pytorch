# Documentation: reportMemoryUsage_test.cpp

## File Metadata
- **Path**: `aten/src/ATen/test/reportMemoryUsage_test.cpp`
- **Size**: 1350 bytes
- **Lines**: 46
- **Extension**: .cpp
- **Type**: Regular file

## Original Source

```cpp
#include <ATen/test/reportMemoryUsage.h>

#include <gtest/gtest.h>

#include <c10/core/CPUAllocator.h>

TEST(DefaultCPUAllocator, check_reporter) {
  auto reporter = std::make_shared<TestMemoryReportingInfo>();
  c10::DebugInfoGuard guard(c10::DebugInfoKind::PROFILER_STATE, reporter);

  auto allocator = c10::GetCPUAllocator();

  auto alloc1 = allocator->allocate(42);
  auto r = reporter->getLatestRecord();
  EXPECT_EQ(alloc1.get(), r.ptr);
  EXPECT_EQ(42, r.alloc_size);
  EXPECT_EQ(42, r.total_allocated);
  EXPECT_EQ(0, r.total_reserved);
  EXPECT_TRUE(r.device.is_cpu());

  auto alloc2 = allocator->allocate(1038);
  r = reporter->getLatestRecord();
  EXPECT_EQ(alloc2.get(), r.ptr);
  EXPECT_EQ(1038, r.alloc_size);
  EXPECT_EQ(1080, r.total_allocated);
  EXPECT_EQ(0, r.total_reserved);
  EXPECT_TRUE(r.device.is_cpu());

  auto alloc1_ptr = alloc1.get();
  alloc1.clear();
  r = reporter->getLatestRecord();
  EXPECT_EQ(alloc1_ptr, r.ptr);
  EXPECT_EQ(-42, r.alloc_size);
  EXPECT_EQ(1038, r.total_allocated);
  EXPECT_EQ(0, r.total_reserved);
  EXPECT_TRUE(r.device.is_cpu());

  auto alloc2_ptr = alloc2.get();
  alloc2.clear();
  r = reporter->getLatestRecord();
  EXPECT_EQ(alloc2_ptr, r.ptr);
  EXPECT_EQ(-1038, r.alloc_size);
  EXPECT_EQ(0, r.total_allocated);
  EXPECT_EQ(0, r.total_reserved);
  EXPECT_TRUE(r.device.is_cpu());
}

```

## High-Level Overview

This file is part of the PyTorch repository. It is a C++/CUDA source/header file that may contain implementations, declarations, or kernel code.

## Detailed Walkthrough


## Key Components

The file contains 88 words across 46 lines of code/text.

## Usage & Examples

This file is part of the larger PyTorch codebase. For usage examples, refer to related test files and documentation.

## Performance & Security Notes

- File size: 1350 bytes
- Complexity: Standard

## Related Files

See the folder index for related files in the same directory.

## Testing

Refer to the PyTorch test suite for test coverage of this file.

---
*Generated by Repo Book Generator v1.0*
