# Documentation: mobile_memory_cleanup.cpp

## File Metadata
- **Path**: `aten/src/ATen/test/mobile_memory_cleanup.cpp`
- **Size**: 1335 bytes
- **Lines**: 41
- **Extension**: .cpp
- **Type**: Regular file

## Original Source

```cpp
#include <gtest/gtest.h>

#include <torch/csrc/jit/passes/xnnpack_rewrite.h>
#include <torch/torch.h>

using namespace torch::jit;

#ifdef USE_XNNPACK

TEST(MemoryCleanUp, NoErrorWithoutRelease) {
  Module m("m");
  m.register_parameter("weight", torch::ones({20, 1, 5, 5}), false);
  m.register_parameter("bias", torch::ones({20}), false);
  m.define(R"(
    def forward(self, input):
      return torch._convolution(input, self.weight, self.bias, [1, 1], [0, 0], [1, 1], False, [0, 0], 1, False, False, True, True)
  )");
  m.eval();
  auto m_optimized = optimizeForMobile(m);
  std::stringstream ss;
  // NOLINTNEXTLINE(cppcoreguidelines-avoid-goto,hicpp-avoid-goto)
  EXPECT_NO_THROW(m_optimized.save(ss));
}

TEST(MemoryCleanUp, UnpackError) {
  at::globalContext().setReleaseWeightsWhenPrepacking(true);
  Module m("m");
  m.register_parameter("weight", torch::ones({20, 1, 5, 5}), false);
  m.register_parameter("bias", torch::ones({20}), false);
  m.define(R"(
    def forward(self, input):
      return torch._convolution(input, self.weight, self.bias, [1, 1], [0, 0], [1, 1], False, [0, 0], 1, False, False, True, True)
  )");
  m.eval();
  auto m_optimized = optimizeForMobile(m);
  std::stringstream ss;
  // NOLINTNEXTLINE(cppcoreguidelines-avoid-goto,hicpp-avoid-goto)
  EXPECT_ANY_THROW(m_optimized.save(ss));
}

#endif

```

## High-Level Overview

This file is part of the PyTorch repository. It is a C++/CUDA source/header file that may contain implementations, declarations, or kernel code.

## Detailed Walkthrough


## Key Components

The file contains 109 words across 41 lines of code/text.

## Usage & Examples

This file is part of the larger PyTorch codebase. For usage examples, refer to related test files and documentation.

## Performance & Security Notes

- File size: 1335 bytes
- Complexity: Standard

## Related Files

See the folder index for related files in the same directory.

## Testing

Refer to the PyTorch test suite for test coverage of this file.

---
*Generated by Repo Book Generator v1.0*
