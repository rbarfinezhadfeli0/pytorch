# Documentation: `tools/code_coverage/package/tool/parser/llvm_coverage_segment.py`

## File Metadata

- **Path**: `tools/code_coverage/package/tool/parser/llvm_coverage_segment.py`
- **Size**: 1,975 bytes (1.93 KB)
- **Type**: Python Source Code
- **Extension**: `.py`

## File Purpose

This file is a **utility or tool script**.

## Original Source

```python
from __future__ import annotations

from typing import NamedTuple


class LlvmCoverageSegment(NamedTuple):
    line: int
    col: int
    segment_count: int
    has_count: int
    is_region_entry: int
    is_gap_entry: int | None

    @property
    def has_coverage(self) -> bool:
        return self.segment_count > 0

    @property
    def is_executable(self) -> bool:
        return self.has_count > 0

    def get_coverage(
        self, prev_segment: LlvmCoverageSegment
    ) -> tuple[list[int], list[int]]:
        # Code adapted from testpilot.testinfra.runners.gtestcoveragerunner.py
        if not prev_segment.is_executable:
            return [], []

        # this segment ends at the line if col == 1
        # (so segment effectively ends on the line) and
        # line+1 if col is > 1 (so it touches at least some part of last line).
        end_of_segment = self.line if self.col == 1 else self.line + 1
        lines_range = list(range(prev_segment.line, end_of_segment))
        return (lines_range, []) if prev_segment.has_coverage else ([], lines_range)


def parse_segments(raw_segments: list[list[int]]) -> list[LlvmCoverageSegment]:
    """
    Creates LlvmCoverageSegment from a list of lists in llvm export json.
    each segment is represented by 5-element array.
    """
    ret: list[LlvmCoverageSegment] = []
    for raw_segment in raw_segments:
        assert len(raw_segment) == 5 or len(raw_segment) == 6, (
            "list is not compatible with llvmcom export:"
        )
        " Expected to have 5 or 6 elements"
        if len(raw_segment) == 5:
            ret.append(
                LlvmCoverageSegment(
                    raw_segment[0],
                    raw_segment[1],
                    raw_segment[2],
                    raw_segment[3],
                    raw_segment[4],
                    None,
                )
            )
        else:
            ret.append(LlvmCoverageSegment(*raw_segment))

    return ret

```



## High-Level Overview

"""    Creates LlvmCoverageSegment from a list of lists in llvm export json.    each segment is represented by 5-element array.

This Python file contains 1 class(es) and 4 function(s).

## Detailed Analysis

### Code Structure

**Classes defined**: `LlvmCoverageSegment`

**Functions defined**: `has_coverage`, `is_executable`, `get_coverage`, `parse_segments`

**Key imports**: annotations, NamedTuple


*For complete code details, see the Original Source section above.*


## Architecture & Design

### Role in PyTorch Architecture

This file is located in `tools/code_coverage/package/tool/parser`, which contains **development tools and scripts**.



## Dependencies

### Import Dependencies

This file imports:

- `__future__`: annotations
- `typing`: NamedTuple


## Code Patterns & Idioms

### Common Patterns

*No specific patterns automatically detected.*


## Performance Considerations

### Performance Notes


*Detailed performance analysis requires profiling and benchmarking.*


## Security & Safety

### Security Considerations

- No obvious security concerns detected in automated analysis.

*Manual security review is recommended for production code.*


## Testing & Usage

### Testing

Test files for this module may be located in the `test/` directory.

### Usage Examples

*See the source code and related test files for usage examples.*


## Related Files

### Related Files

Files in the same folder (`tools/code_coverage/package/tool/parser`):

- [`__init__.py_docs.md`](./__init__.py_docs.md)
- [`gcov_coverage_parser.py_docs.md`](./gcov_coverage_parser.py_docs.md)
- [`llvm_coverage_parser.py_docs.md`](./llvm_coverage_parser.py_docs.md)
- [`coverage_record.py_docs.md`](./coverage_record.py_docs.md)


## Cross-References

- **File Documentation**: `llvm_coverage_segment.py_docs.md`
- **Keyword Index**: `llvm_coverage_segment.py_kw.md`
- **Folder Index**: `index.md`
- **Folder Documentation**: `doc.md`

---

*Generated by PyTorch Repository Documentation System*
