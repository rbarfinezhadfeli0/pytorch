# Documentation: `tools/config/defs.bzl`

## File Metadata

- **Path**: `tools/config/defs.bzl`
- **Size**: 2,267 bytes (2.21 KB)
- **Type**: Source File (.bzl)
- **Extension**: `.bzl`

## File Purpose

This file is a **utility or tool script**.

## Original Source

```
"""
 Macros for selecting with / without various GPU libraries.  Most of these are meant to be used
 directly by tensorflow in place of their build's own configure.py + bazel-gen system.
"""

load("@bazel_skylib//lib:selects.bzl", "selects")

def if_cuda(if_true, if_false = []):
    """Helper for selecting based on the whether CUDA is configured. """
    return selects.with_or({
        "@//tools/config:cuda_enabled_and_capable": if_true,
        "//conditions:default": if_false,
    })

def if_tensorrt(if_true, if_false = []):
    """Helper for selecting based on the whether TensorRT is configured. """
    return select({
        "//conditions:default": if_false,
    })

def if_rocm(if_true, if_false = []):
    """Helper for selecting based on the whether ROCM is configured. """
    return select({
        "//conditions:default": if_false,
    })

def if_sycl(if_true, if_false = []):
    """Helper for selecting based on the whether SYCL/ComputeCPP is configured."""

    # NOTE: Tensorflow expects some strange behavior (see their if_sycl) if we
    # actually plan on supporting this at some point.
    return select({
        "//conditions:default": if_false,
    })

def if_ccpp(if_true, if_false = []):
    """Helper for selecting based on the whether ComputeCPP is configured. """
    return select({
        "//conditions:default": if_false,
    })

def cuda_default_copts():
    return if_cuda(["-DGOOGLE_CUDA=1"])

def cuda_default_features():
    return if_cuda(["-per_object_debug_info", "-use_header_modules", "cuda_clang"])

def rocm_default_copts():
    return if_rocm(["-x", "rocm"])

def rocm_copts(opts = []):
    return rocm_default_copts() + if_rocm(opts)

def cuda_is_configured():
    # FIXME(dcollins): currently only used by tensorflow's xla stuff, which we aren't building.  However bazel
    # query hits it so this needs to be defined.  Because bazel doesn't actually resolve config at macro expansion
    # time, `select` can't be used here (since xla expects lists of strings and not lists of select objects).
    # Instead, the xla build rules must be rewritten to use `if_cuda_is_configured`
    return False

def if_cuda_is_configured(x):
    return if_cuda(x, [])

def if_rocm_is_configured(x):
    return if_rocm(x, [])

```



## High-Level Overview

This file is part of the PyTorch framework located at `tools/config`.

## Detailed Analysis

### Code Structure


*For complete code details, see the Original Source section above.*


## Architecture & Design

### Role in PyTorch Architecture

This file is located in `tools/config`, which contains **development tools and scripts**.



## Dependencies

### Import Dependencies

*Dependency analysis not applicable for this file type.*


## Code Patterns & Idioms

### Common Patterns

*No specific patterns automatically detected.*


## Performance Considerations

### Performance Notes

- This file appears to involve **GPU/parallel computing** capabilities.

*Detailed performance analysis requires profiling and benchmarking.*


## Security & Safety

### Security Considerations

- No obvious security concerns detected in automated analysis.

*Manual security review is recommended for production code.*


## Testing & Usage

### Testing

Test files for this module may be located in the `test/` directory.

### Usage Examples

*See the source code and related test files for usage examples.*


## Related Files

### Related Files

Files in the same folder (`tools/config`):



## Cross-References

- **File Documentation**: `defs.bzl_docs.md`
- **Keyword Index**: `defs.bzl_kw.md`
- **Folder Index**: `index.md`
- **Folder Documentation**: `doc.md`

---

*Generated by PyTorch Repository Documentation System*
